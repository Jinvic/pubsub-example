# ğŸ“£ Go Pub/Sub å‘å¸ƒè®¢é˜…æ¨¡å‹ç¤ºä¾‹

> [!NOTE]
> This readme is generated by Qwen3.

ä¸€ä¸ªè½»é‡çº§ã€å¹¶å‘å®‰å…¨çš„å‘å¸ƒ-è®¢é˜…ï¼ˆPublish-Subscribeï¼‰æ¨¡å‹ç¤ºä¾‹ï¼Œä½¿ç”¨ Go è¯­è¨€å®ç°ã€‚

## âœ¨ ç‰¹æ€§

- **å®Œå…¨å¹¶å‘å®‰å…¨**ï¼šä½¿ç”¨ `sync.RWMutex` ä¿æŠ¤å…±äº«çŠ¶æ€ã€‚
- **çµæ´»è®¢é˜…**ï¼šæ”¯æŒè®¢é˜…å…·ä½“ä¸»é¢˜æˆ–æ‰€æœ‰ä¸»é¢˜ï¼ˆ`""`ï¼‰ã€‚
- **è‡ªåŠ¨/æ‰‹åŠ¨æ³¨å†Œ**ï¼šåˆ›å»ºå®ä¾‹æ—¶å¯é€‰æ‹©æ˜¯å¦è‡ªåŠ¨æ³¨å†Œåˆ°å…¨å±€ç®¡ç†å™¨ã€‚
- **å¼‚æ­¥éé˜»å¡å‘å¸ƒ**ï¼šå‘å¸ƒæ¶ˆæ¯ä¸é˜»å¡ï¼Œé€šè¿‡ Goroutine å¼‚æ­¥æŠ•é€’ã€‚
- **ç¼“å†²æ¶ˆæ¯é€šé“**ï¼šè®¢é˜…è€…è‡ªå¸¦å¯é…ç½®ç¼“å†²åŒºçš„æ¶ˆæ¯é€šé“ã€‚
- **ä¼˜é›…èµ„æºç®¡ç†**ï¼šæä¾› `Close` å’Œ `Unregister` æ–¹æ³•æ¸…ç†èµ„æºã€‚
- **å”¯ä¸€ ID ç”Ÿæˆ**ï¼šåŸºäº UUID ç”Ÿæˆå¸¦ç±»å‹å‰ç¼€çš„å”¯ä¸€ IDã€‚

## ğŸ“¦ å®‰è£…

```bash
go get github.com/Jinvic/pubsub-exmaple
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

```go
package main

import (
    "fmt"
    "time"
    pubsub "Jinvic/pubsub-exmaple"
)

func main() {
    // 1. åˆ›å»ºå‘å¸ƒè€…
    publisher := pubsub.NewPublisher(true)

    // 2. åˆ›å»ºè®¢é˜…è€…
    subscriber := pubsub.NewSubscriber(10, true)

    // 3. è®¢é˜…ä¸»é¢˜
    subscriber.Subscribe(publisher.ID, "news")
    subscriber.Subscribe(publisher.ID, "") // è®¢é˜…æ‰€æœ‰ä¸»é¢˜

    // 4. å‘å¸ƒæ¶ˆæ¯
    publisher.Publish([]string{"news"}, []byte("Hello, World!"))

    // 5. æ¶ˆè´¹æ¶ˆæ¯ (é˜»å¡)
    msg := subscriber.Consume()
    fmt.Printf("Received: %s\n", string(msg.Data))

    // æˆ–ä½¿ç”¨éé˜»å¡æ–¹å¼
    if msg, ok := subscriber.TryConsume(); ok {
        fmt.Printf("Received: %s\n", string(msg.Data))
    }

    // 6. æ¸…ç†èµ„æº
    subscriber.Close() // å…³é—­é€šé“å¹¶è‡ªåŠ¨æ³¨é”€
}
```

## ğŸ§° API å‚è€ƒ

### `NewPublisher(autoRegister bool) *Publisher`

åˆ›å»ºæ–°çš„å‘å¸ƒè€…ã€‚

- `autoRegister=true`ï¼šåˆ›å»ºåè‡ªåŠ¨æ³¨å†Œåˆ°å…¨å±€ `Publishers` æ˜ å°„ã€‚
- è¿”å›ï¼š`*Publisher`

### `NewSubscriber(bufferSize int, autoRegister bool) *Subscriber`

åˆ›å»ºæ–°çš„è®¢é˜…è€…ã€‚

- `bufferSize<=0`ï¼šä½¿ç”¨é»˜è®¤å€¼ 10ã€‚
- `autoRegister=true`ï¼šåˆ›å»ºåè‡ªåŠ¨æ³¨å†Œã€‚
- è¿”å›ï¼š`*Subscriber`

### `Publisher` æ–¹æ³•

| æ–¹æ³• | æè¿° |
|------|------|
| `Publish(topics []string, data []byte)` | å‘æŒ‡å®šä¸»é¢˜å‘å¸ƒæ¶ˆæ¯ã€‚ |
| `Unregister()` | ä»å…¨å±€æ˜ å°„ä¸­æ³¨é”€è¯¥å‘å¸ƒè€…ã€‚ |

### `Subscriber` æ–¹æ³•

| æ–¹æ³• | æè¿° |
|------|------|
| `Subscribe(pubID, topic string)` | è®¢é˜…æŸä¸ªå‘å¸ƒè€…çš„ä¸»é¢˜ã€‚ |
| `UnsubscribeTopic(pubID, topics []string)` | å–æ¶ˆè®¢é˜…æŒ‡å®šä¸»é¢˜ã€‚ |
| `UnsubscribePublisher(pubID)` | å–æ¶ˆè®¢é˜…è¯¥å‘å¸ƒè€…çš„æ‰€æœ‰ä¸»é¢˜ã€‚ |
| `Receive(msg Message)` | æ¥æ”¶æ¶ˆæ¯ï¼ˆç”±å‘å¸ƒè€…è°ƒç”¨ï¼‰ã€‚ |
| `Consume() Message` | é˜»å¡å¼æ¶ˆè´¹ä¸€æ¡æ¶ˆæ¯ã€‚ |
| `TryConsume() (Message, bool)` | éé˜»å¡æ¶ˆè´¹ï¼Œè¿”å› `(æ¶ˆæ¯, æ˜¯å¦æ”¶åˆ°)`ã€‚ |
| `Close()` | å…³é—­æ¶ˆæ¯é€šé“å¹¶æ³¨é”€è®¢é˜…è€…ã€‚ |

### å…¨å±€å‡½æ•°

| å‡½æ•° | æè¿° |
|------|------|
| `RegisterPublisher`, `RegisterSubscriber` | æ‰‹åŠ¨æ³¨å†Œå®ä¾‹ã€‚ |
| `UnregisterPublisher`, `UnregisterSubscriber` | æ‰‹åŠ¨æ³¨é”€å®ä¾‹ã€‚ |
| `GetPublisher`, `GetSubscriber` | é€šè¿‡ ID è·å–å®ä¾‹ã€‚ |

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ä¸»é¢˜åŒ¹é…**ï¼š
   - è®¢é˜… `""` è¡¨ç¤ºæ¥æ”¶è¯¥å‘å¸ƒè€…çš„**æ‰€æœ‰**æ¶ˆæ¯ã€‚
   - è®¢é˜…å…·ä½“ä¸»é¢˜ `"news"` åªæ¥æ”¶è¯¥ä¸»é¢˜æ¶ˆæ¯ã€‚
   - ä¸¤è€…å¯ä»¥åŒæ—¶å­˜åœ¨ã€‚

2. **èµ„æºæ¸…ç†**ï¼š
   - å»ºè®®åœ¨ `defer` ä¸­è°ƒç”¨ `subscriber.Close()` æˆ– `publisher.Unregister()`ã€‚
   - `Close()` ä¼šå…³é—­ `MsgChan`ï¼Œåç»­ `Receive` è°ƒç”¨å°† panicã€‚

3. **å¹¶å‘å®‰å…¨**ï¼š
   - æ‰€æœ‰å…¬å¼€æ–¹æ³•éƒ½æ˜¯å¹¶å‘å®‰å…¨çš„ã€‚
   - `Consume` å’Œ `TryConsume` å¯ä»¥åœ¨å¤šä¸ª Goroutine ä¸­å®‰å…¨è°ƒç”¨ã€‚

4. **ID å”¯ä¸€æ€§**ï¼šåŸºäº `github.com/google/uuid` ä¿è¯å…¨å±€å”¯ä¸€ã€‚

---

## ğŸ” Todo List

1. **é”™è¯¯å¤„ç†**ï¼š
   - `Subscribe`/`Unsubscribe` æ–¹æ³•å¯ä»¥è¿”å› `error`ï¼Œä¾‹å¦‚å½“å‘å¸ƒè€…ä¸å­˜åœ¨æ—¶ã€‚
   - `Publish` å¯ä»¥è¿”å›å‘é€æˆåŠŸçš„è®¢é˜…è€…æ•°é‡ã€‚

2. **ä¸Šä¸‹æ–‡æ”¯æŒ**ï¼š
   - ä¸º `Publish` æ·»åŠ  `context.Context` å‚æ•°ï¼Œæ”¯æŒè¶…æ—¶æˆ–å–æ¶ˆã€‚

3. **æ¶ˆæ¯åºåˆ—åŒ–**ï¼š
   - æä¾› `Message` çš„ JSON åºåˆ—åŒ–æ–¹æ³•ï¼Œä¾¿äºæ—¥å¿—æˆ–ç½‘ç»œä¼ è¾“ã€‚

4. **æ€§èƒ½ç›‘æ§**ï¼š
   - æ·»åŠ è®¡æ•°å™¨ç»Ÿè®¡å‘å¸ƒ/è®¢é˜…æ¬¡æ•°ã€‚

5. **æ–‡æ¡£æ³¨é‡Š**ï¼š
   - ä¸ºæ‰€æœ‰å¯¼å‡ºçš„ç±»å‹å’Œæ–¹æ³•æ·»åŠ  `godoc` æ³¨é‡Šã€‚

6. **ç¤ºä¾‹ç›®å½•**ï¼š
   - æ·»åŠ  `examples/` ç›®å½•ï¼Œæä¾›æ›´å¤æ‚çš„ä½¿ç”¨åœºæ™¯ã€‚
